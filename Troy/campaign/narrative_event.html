<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
	<title>Narrative Events script class</title>
	<link rel="stylesheet" href="../stylesheet.css" type="text/css" />
</head>

<body>

	<a name="top"></a>

	<div id="container">

		<div style="background-color:#fff7cc" id="main">

			<div style="background-color:#fff7cc" id="navigation_left">
				<br/>
				<h1 class="navigation_header"><i>Campaign Documentation</i></h1>
				<a href="../index.html">Scripting Homepage</a>
				<h2 style="background-color:#ffed8c">Search</h2>
				<ul>
				<form id="search_env_checkbox" class="search_env_checkbox">
					<label for="search_current_env_only">Search campaign only</label>
					<input type="checkbox" name="search_current_env_only" checked /><br />
				</form>
				<form id="search" class="search_form" onsubmit="return false">
					<input class="search_input" type="text" placeholder="Search.."/><br />
					<div id="search_dropdown" class="search_dropdown"></div>
				</form>				<h2 style="background-color:#ffed8c">Game Areas</h2>
				<ul>
					<li><strong> > Campaign Index</strong></li>
					<li><a href="../battle/battle_index.html">Battle Index</a></li>
					<li><a href="../frontend/frontend_index.html">Frontend Index</a></li>
				</ul>

				<h2 style="background-color:#ffed8c">On this page</h2>
				<ul>
				<div class="key">
					<strong>Key</strong>
					<table class="key">
						<tr>
							<td width="75%">Loaded in Battle</td>
							<td><img alt="loaded in battle" style="float:right;" src="../images/loaded_in_battle.png" height="10" width="10" /></td>
						</tr>
						<tr>
							<td width="75%">Loaded in Campaign</td>
							<td><img alt="loaded in campaign" style="float:right;" src="../images/loaded_in_campaign.png" height="10" width="10" /></td>
						</tr>
						<tr>
							<td width="75%">Loaded in Frontend</td>
							<td><img alt="loaded in frontend" style="float:right;" src="../images/loaded_in_frontend.png" height="10" width="10" /></td>
						</tr>
					</table>
				</div>
					<li><a href="#class:narrative_event">Narrative Events</a><img alt="loaded in campaign" style="float:right; margin-right:1em;" src="../images/loaded_in_campaign.png" height="10" width="10" /></li>
					<ul>
						<li>&emsp;&emsp;<a href="#section:narrative_event:Creation">Creation</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:new">new</a></li>
						<li>&emsp;&emsp;<a href="#section:narrative_event:Usage">Usage</a></li>
						<li>&emsp;&emsp;<a href="#section:narrative_event:Querying">Querying</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:is_running">is_running</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:has_triggered_this_campaign">has_triggered_this_campaign</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:has_been_seen_in_advice_history">has_been_seen_in_advice_history</a></li>
						<li>&emsp;&emsp;<a href="#section:narrative_event:Scripted Objectives">Scripted Objectives</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:add_new_objective">add_new_objective</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:add_condition">add_condition</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:add_payload">add_payload</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:set_mission_issuer">set_mission_issuer</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:get_mission_manager">get_mission_manager</a></li>
						<li>&emsp;&emsp;<a href="#section:narrative_event:Payload Inheritance">Payload Inheritance</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:add_narrative_event_payload_inheritance">add_narrative_event_payload_inheritance</a></li>
						<li>&emsp;&emsp;<a href="#section:narrative_event:Scripted Events and Callbacks">Scripted Events and Callbacks</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:set_event_on_triggered">set_event_on_triggered</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:set_event_on_mission_completed">set_event_on_mission_completed</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:set_trigger_callback">set_trigger_callback</a></li>
						<li>&emsp;&emsp;<a href="#section:narrative_event:Narrative Event Categories">Narrative Event Categories</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:set_category">set_category</a></li>
						<li>&emsp;&emsp;<a href="#section:narrative_event:Camera Scrolling">Camera Scrolling</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:set_camera_scroll_target_callback">set_camera_scroll_target_callback</a></li>
						<li>&emsp;&emsp;<a href="#section:narrative_event:Preconditions">Preconditions</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:add_precondition">add_precondition</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:remove_precondition">remove_precondition</a></li>
						<li>&emsp;&emsp;<a href="#section:narrative_event:Advice Preconditions">Advice Preconditions</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:add_advice_precondition">add_advice_precondition</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:remove_advice_precondition">remove_advice_precondition</a></li>
						<li>&emsp;&emsp;<a href="#section:narrative_event:Trigger Conditions">Trigger Conditions</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:add_trigger_condition">add_trigger_condition</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:remove_trigger_condition">remove_trigger_condition</a></li>
						<li>&emsp;&emsp;<a href="#section:narrative_event:Starting">Starting</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:start">start</a></li>
					</ul>

				</ul>
			</div>

			<div style="background-color:#fff7cc" id="navigation_right">				<h2 style="background-color:#ffed8c">Campaign Topics</h2>
				<ul>
					<li><a href="campaign_index.html">Campaign Index</a></li>
					<li><a href="campaign_script_structure.html">Campaign Script Structure</a></li>
					<li><a href="lua.html">Lua Language</a></li>
					<li><a href="scripted_events.html">Scripted Events</a></li>

				</ul>

				<h2 style="background-color:#ffed8c">Game Code Pages</h2>
				<ul>
					<li><a href="campaignui.html">CampaignUI</a></li>
					<li><a href="cinematics.html">Cinematics</a></li>
					<li><a href="effect.html">Effect</a></li>
					<li><a href="episodic_scripting.html">Episodic Scripting</a></li>
					<li><a href="scriptedvalueregistry.html">ScriptedValueRegistry</a></li>
					<li><a href="uicomponent.html">UIComponents</a></li>

				</ul>

				<h2 style="background-color:#ffed8c">Script Pages</h2>
				<ul>
					<li><a href="campaign_manager.html">Campaign Manager</a></li>
					<li><a href="core_object.html">Core</a></li>
					<li><a href="campaign_cutscene.html">Campaign Cutscenes</a></li>
					<li><a href="campaign_interface.html">Campaign Interface</a></li>
					<li><a href="campaign_ui_manager.html">Campaign UI Manager</a></li>
					<li><a href="chapter_mission.html">Chapter Missions</a></li>
					<li><a href="convex_area.html">Convex Areas</a></li>
					<li><a href="global.html">Global</a></li>
					<li><a href="infotext_manager.html">Infotext Manager</a></li>
					<li><a href="intervention.html">Interventions</a></li>
					<li><a href="invasion_manager.html">Invasion Manager</a></li>
					<li><a href="mission_manager.html">Mission Managers</a></li>
					<li><strong> > Narrative Events</strong></li>
					<li><a href="objectives_manager.html">Objectives Manager</a></li>
					<li><a href="random_army_manager.html">Random Army Manager</a></li>
					<li><a href="script_messager.html">Script Messager</a></li>
					<li><a href="text_pointer.html">Text Pointers</a></li>

				</ul>
			</div>

			<div id="content">
				<a name="class:narrative_event"><h1 class="content_header">Narrative Events</h1></a>
				<p>Narrative events are a method for easy packaging of a mission with some advice or narrative content, wrapped in an <code><a href="intervention.html#">intervention</a></code>. They are mainly intended for use in early-game missions, which commonly have to show a mission with some advice and occasionally a camera movement, but they can be used for other purposes.</p>
				<p>Once created, a narrative event may be associated with a number of trigger events (and optional conditions) that determine when it should trigger. See the <code><a href="#section:narrative_event:Trigger Conditions">Trigger Conditions</a></code> section for more information. Preconditions may be also be set which narrative event must pass before it can trigger - see <code><a href="#section:narrative_event:Preconditions">Preconditions</a></code>.</p>
				<p>On-issued and on-mission-completed script events may be specified - see the <code><a href="#section:narrative_event:Scripted Events and Callbacks">Scripted Events and Callbacks</a></code> section. These script events are triggered when the narrative event object triggers its mission/advice and when the mission is completed. The intention is that these may be used by client scripts to easily daisychain narrative events together, so that the completion or triggering of one leads to the triggering of another.</p>
				<p>Once set up, the listeners associated with a narrative event must be started with <code><a href="#function:narrative_event:start">narrative_event:start</a></code>.</p>
				<p>By default, narrative events will attempt to reduce the intrusiveness of advice, including not delivering the advice at all, if it's detected that the advice has been delivered before. This typically occurs when the player is experiencing the same narrative event on subsequent campaign playthroughs. See the <code><a href="#section:narrative_event:Narrative Event Categories">Narrative Event Categories</a></code> section for more information.</p>
				<p>Narrative events may be declared and supported in multiplayer mode, but their content delivery will not be wrapped in an <code><a href="intervention.html#">intervention</a></code> and no advice will be shown.</p>
							<table class="loaded_in" style="margin-top: 1em;">
								<tr>
									<td>
										Loaded in Campaign
									</td>
									<td>
										<img alt="loaded in campaign" style="float:right;" src="../images/loaded_in_campaign.png" height="18" width="18" />
									</td>
								</tr>
							</table>

				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_event:Creation"><h2 class="section_header">Creation</h2></a>
				</div>
				<p>Narrative events create persistent <code><a href="mission_manager.html#">mission_manager</a></code> objects internally. Due to this, narrative events need to be created before the first tick occurs - see the section in the mission manager documentation on <code><a href="mission_manager.html#section:mission_manager:Persistence">Persistence</a></code> for more information.</p>
				<div class="section_body">
					<dl class="function">
						<dt>
							<a name="function:narrative_event:new"><h3 class="function_name"><strong><code>narrative_event:new(<br />&emsp;&emsp;<code><a href="string.html#">string</a></code> </strong></code><i class="parameter">name</i><code><strong>, <br />&emsp;&emsp;<code><a href="string.html#">string</a></code> </strong></code><i class="parameter">faction key</i><code><strong>, <br />&emsp;&emsp;[<code><a href="string.html#">string</a></code> </strong></code><i class="parameter">advice key</i><code><strong>], <br />&emsp;&emsp;[<code><a href="table.html#">table</a></code> </strong></code><i class="parameter">infotext</i><code><strong>], <br />&emsp;&emsp;[<code><a href="string.html#">string</a></code> </strong></code><i class="parameter">mission key</i><code><strong>], <br />&emsp;&emsp;[<code><a href="string.html#">string</a></code> </strong></code><i class="parameter">completion event</i><code><strong>]<br />)</code></strong></h3></a>
						</dt>
						<dd>
							Creates and returns a narrative event object. An advice key, infotext, and mission key may optionally be specified. Alternatively, narrative elements (e.g. cutscenes, event messages) can be triggered by adding them as an on-trigger callback using <code><a href="#function:narrative_event:set_trigger_callback">narrative_event:set_trigger_callback</a></code>.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="string.html#">string</a></code></code></p>
									</td>
									<td>
										<p>Unique name amongst narrative event objects.</p>
									</td>
								</tr>
								<tr>
									<td>
										<p><strong>2</strong></p>
									</td>
									<td>
										<p><code><code><a href="string.html#">string</a></code></code></p>
									</td>
									<td>
										<p>Faction to issue the content to.</p>
									</td>
								</tr>
								<tr>
									<td>
										<p><strong>3</strong></p>
									</td>
									<td>
										<p><code><code><a href="string.html#">string</a></code></code></p>
									</td>
									<td>
										<p><i>optional, default value=nil</i></p>
										<p>Advice key to play with content, from the <code>advice_threads</code> table.</p>
									</td>
								</tr>
								<tr>
									<td>
										<p><strong>4</strong></p>
									</td>
									<td>
										<p><code><code><a href="table.html#">table</a></code></code></p>
									</td>
									<td>
										<p><i>optional, default value=nil</i></p>
										<p>Infotext to issue with advice. This should be a table of strings, each specifying a record from the <code>advice_info_texts</code> table.</p>
									</td>
								</tr>
								<tr>
									<td>
										<p><strong>5</strong></p>
									</td>
									<td>
										<p><code><code><a href="string.html#">string</a></code></code></p>
									</td>
									<td>
										<p><i>optional, default value=nil</i></p>
										<p>Key of mission record from <code>missions</code> table to issue.</p>
									</td>
								</tr>
								<tr>
									<td>
										<p><strong>6</strong></p>
									</td>
									<td>
										<p><code><code><a href="string.html#">string</a></code></code></p>
									</td>
									<td>
										<p><i>optional, default value=nil</i></p>
										<p>Script event to trigger when the supplied mission is completed.</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code><code><a href="#">narrative_event</a></code></code> narrative event</li>
							</ol>
							<p class="file_comment">defined in ../working_data/script/_lib/lib_campaign_narrative_events.lua, line 91</p>
						</dd>
					</dl>
				</div>


				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_event:Usage"><h2 class="section_header">Usage</h2></a>
				</div>
				<p>A narrative event object is created and returned by calling <code><a href="#function:narrative_event:new">narrative_event:new</a></code>. Once created, functions on a <code>narrative_event</code> may be called in the form showed below.</p>

				<h4>Example - Specification:</h4>
				<div id="example_code"><code>
					 <i>&lt;narrative_event_object&gt;</i>:<i>&lt;function_name&gt;</i>(<i>&lt;args&gt;</i>)<br />
				</code></div>

				<h4>Example - Creation and Usage:</h4>
				<div id="example_code"><code>
					 local ne_example = narrative_event:new(name, faction_key, advice_key, infotext, mission_key, event_on_mission_completed)<br />
					 &emsp;&emsp;&emsp;&emsp;"example_early_game_narrative_event",<br />
					 &emsp;&emsp;&emsp;&emsp;"troy_main_dan_mycenae",<br />
					 &emsp;&emsp;&emsp;&emsp;"troy_camp_early_game_example_01",<br />
					 &emsp;&emsp;&emsp;&emsp;nil,<br />
					 &emsp;&emsp;&emsp;&emsp;"troy_main_mycenae_early_game_example_mission_key_01"<br />
					 &emsp;&emsp;&emsp;&emsp;"ScriptEventMycenaeExampleMission01Completed"<br />
					 )<br />
					 <br />
					 -- calling a function on the object once created<br />
					 ne_example:add_trigger_condition(<br />
					&emsp;&emsp;&emsp;&emsp;"FactionTurnStart",<br />
					&emsp;&emsp;&emsp;&emsp;function(context)<br />
					&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;return context:faction():name() == "troy_main_dan_mycenae" and cm:turn_number() >= 3<br />
					&emsp;&emsp;&emsp;&emsp;end<br />
					 );<br />
					 <br />
					 -- start listening for the trigger condition<br />
					 ne_example:start();<br />
				</code></div>
				<div class="section_body">
				</div>


				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_event:Querying"><h2 class="section_header">Querying</h2></a>
				</div>
				<div class="section_body">
					<dl class="function">
						<dt>
							<a name="function:narrative_event:is_running"><h3 class="function_name"><strong><code>narrative_event:is_running()</code></strong></h3></a>
						</dt>
						<dd>
							Returns whether this narrative event is currently active and listening for its various trigger conditions. This becomes <code>true</code> when <code><a href="#function:narrative_event:start">narrative_event:start</a></code> is called and <code>false</code> when the narrative event triggers.


							<h4>Returns:</h4>
							<ol>
								<li><code><code><a href="boolean.html#">boolean</a></code></code> is running</li>
							</ol>
							<p class="file_comment">defined in ../working_data/script/_lib/lib_campaign_narrative_events.lua, line 249</p>
						</dd>
					</dl>
					<dl class="function">
						<dt>
							<a name="function:narrative_event:has_triggered_this_campaign"><h3 class="function_name"><strong><code>narrative_event:has_triggered_this_campaign()</code></strong></h3></a>
						</dt>
						<dd>
							Returns whether this narrative event has triggered in this campaign save.


							<h4>Returns:</h4>
							<ol>
								<li><code><code><a href="boolean.html#">boolean</a></code></code> has triggered</li>
							</ol>
							<p class="file_comment">defined in ../working_data/script/_lib/lib_campaign_narrative_events.lua, line 257</p>
						</dd>
					</dl>
					<dl class="function">
						<dt>
							<a name="function:narrative_event:has_been_seen_in_advice_history"><h3 class="function_name"><strong><code>narrative_event:has_been_seen_in_advice_history()</code></strong></h3></a>
						</dt>
						<dd>
							Returns whether this narrative event has ever been triggered in any campaign, from the advice history. This is mainly for internal use but can be called externally if required.


							<h4>Returns:</h4>
							<ol>
								<li><code><code><a href="boolean.html#">boolean</a></code></code> has triggered in </li>
							</ol>
							<p class="file_comment">defined in ../working_data/script/_lib/lib_campaign_narrative_events.lua, line 265</p>
						</dd>
					</dl>
				</div>


				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_event:Scripted Objectives"><h2 class="section_header">Scripted Objectives</h2></a>
				</div>
				<p>If a mission key was specified in <code><a href="#function:narrative_event:new">narrative_event:new</a></code> then this mission type can be customised using the functions in this section. These call the equivalent functions on the internally-created mission manager. Alternatively, the internal mission manager may be directly accessed with <code><a href="#function:narrative_event:get_mission_manager">narrative_event:get_mission_manager</a></code>, at which point function calls may be made to it to customise the mission to be delivered.</p>
				<p>If no mission key was specified to <code><a href="#function:narrative_event:new">narrative_event:new</a></code> then no mision manager will have been generated, and these functions will produce errors and return <code>false</code>.</p>
				<div class="section_body">
					<dl class="function">
						<dt>
							<a name="function:narrative_event:add_new_objective"><h3 class="function_name"><strong><code>narrative_event:add_new_objective(<code><a href="string.html#">string</a></code> </strong></code><i class="parameter">objective type</i><code><strong>)</code></strong></h3></a>
						</dt>
						<dd>
							Adds a new scripted objective to the internally-created mission manager. See <code><a href="mission_manager.html#function:mission_manager:add_new_objective">mission_manager:add_new_objective</a></code> for more information.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="string.html#">string</a></code></code></p>
									</td>
									<td>
										<p>objective type</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../working_data/script/_lib/lib_campaign_narrative_events.lua, line 297</p>
						</dd>
					</dl>
					<dl class="function">
						<dt>
							<a name="function:narrative_event:add_condition"><h3 class="function_name"><strong><code>narrative_event:add_condition(<code><a href="string.html#">string</a></code> </strong></code><i class="parameter">condition</i><code><strong>)</code></strong></h3></a>
						</dt>
						<dd>
							Adds a new condition to the mission objective most recently added with <code><a href="#function:narrative_event:add_new_objective">narrative_event:add_new_objective</a></code>. See <code><a href="mission_manager.html#function:mission_manager:add_condition">mission_manager:add_condition</a></code> for more information.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="string.html#">string</a></code></code></p>
									</td>
									<td>
										<p>condition</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../working_data/script/_lib/lib_campaign_narrative_events.lua, line 310</p>
						</dd>
					</dl>
					<dl class="function">
						<dt>
							<a name="function:narrative_event:add_payload"><h3 class="function_name"><strong><code>narrative_event:add_payload(<code><a href="string.html#">string</a></code> </strong></code><i class="parameter">payload</i><code><strong>)</code></strong></h3></a>
						</dt>
						<dd>
							Adds a new payload to the mission objective most recently added with <code><a href="#function:narrative_event:add_new_objective">narrative_event:add_new_objective</a></code>. See <code><a href="mission_manager.html#function:mission_manager:add_payload">mission_manager:add_payload</a></code> for more information.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="string.html#">string</a></code></code></p>
									</td>
									<td>
										<p>payload</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../working_data/script/_lib/lib_campaign_narrative_events.lua, line 323</p>
						</dd>
					</dl>
					<dl class="function">
						<dt>
							<a name="function:narrative_event:set_mission_issuer"><h3 class="function_name"><strong><code>narrative_event:set_mission_issuer(<code><a href="string.html#">string</a></code> </strong></code><i class="parameter">issuer</i><code><strong>)</code></strong></h3></a>
						</dt>
						<dd>
							Sets a mission issuer for the internally-generated mission manager. See <code><a href="mission_manager.html#function:mission_manager:set_mission_issuer">mission_manager:set_mission_issuer</a></code> for more information.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="string.html#">string</a></code></code></p>
									</td>
									<td>
										<p>issuer</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../working_data/script/_lib/lib_campaign_narrative_events.lua, line 336</p>
						</dd>
					</dl>
					<dl class="function">
						<dt>
							<a name="function:narrative_event:get_mission_manager"><h3 class="function_name"><strong><code>narrative_event:get_mission_manager()</code></strong></h3></a>
						</dt>
						<dd>
							Returns the internally-created mission manager, which can be used to further customise the mission to be generated.


							<h4>Returns:</h4>
							<ol>
								<li><code><code><a href="mission_manager.html#">mission_manager</a></code></code> mission manager</li>
							</ol>
							<p class="file_comment">defined in ../working_data/script/_lib/lib_campaign_narrative_events.lua, line 349</p>
						</dd>
					</dl>
				</div>


				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_event:Payload Inheritance"><h2 class="section_header">Payload Inheritance</h2></a>
				</div>
				<p>Narrative events may be set to inherit mission reward payloads from other narrative events, if that other narrative event has not yet triggered by the time the first does. This is to allow chains of narrative missions set up where individual missions can be bypassed without the player losing out on the reward that mission would bring.</p>
				<p>Consider two narrative events that encapsulates missions, one to recruit an agent and another to use an agent against an enemy target. Neither has yet triggered. The agent-action mission, which triggers when an agent is recruited, would naturally lead on from the first, but not in all cases - the player may be gifted an agent from an incident or other scripted event. By setting the agent-action mission to inherit the rewards of the recruit-agent mission, the rewards of the now-redundant recruit-agent mission will be rolled in to the agent-action mission, meaning the player is not penalised for having inadvertantly skipped a mission before it can trigger.</p>
				<p>If the narrative event being inherited from has already triggered then those rewards are not inherited. Should one narrative event inherit the rewards of another, that second narrative event will shut down and be unable to trigger.</p>
				<div class="section_body">
					<dl class="function">
						<dt>
							<a name="function:narrative_event:add_narrative_event_payload_inheritance"><h3 class="function_name"><strong><code>narrative_event:add_narrative_event_payload_inheritance(<code><a href="string.html#">string</a></code> </strong></code><i class="parameter">narrative event name</i><code><strong>, <code><a href="string.html#">string</a></code> </strong></code><i class="parameter">faction key</i><code><strong>)</code></strong></h3></a>
						</dt>
						<dd>
							Marks this narrative event as inheriting from another narrative event. The other narrative event is specified by the unique name and faction key supplied on creation.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="string.html#">string</a></code></code></p>
									</td>
									<td>
										<p>narrative event name</p>
									</td>
								</tr>
								<tr>
									<td>
										<p><strong>2</strong></p>
									</td>
									<td>
										<p><code><code><a href="string.html#">string</a></code></code></p>
									</td>
									<td>
										<p>faction key</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../working_data/script/_lib/lib_campaign_narrative_events.lua, line 373</p>
						</dd>
					</dl>
				</div>


				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_event:Scripted Events and Callbacks"><h2 class="section_header">Scripted Events and Callbacks</h2></a>
				</div>
				<div class="section_body">
					<dl class="function">
						<dt>
							<a name="function:narrative_event:set_event_on_triggered"><h3 class="function_name"><strong><code>narrative_event:set_event_on_triggered(<code><a href="string.html#">string</a></code> </strong></code><i class="parameter">event</i><code><strong>)</code></strong></h3></a>
						</dt>
						<dd>
							Sets a script event that fires when this narrative event triggers. Other scripts can listen for this event and respond accordingly.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="string.html#">string</a></code></code></p>
									</td>
									<td>
										<p>event</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../working_data/script/_lib/lib_campaign_narrative_events.lua, line 448</p>
						</dd>
					</dl>
					<dl class="function">
						<dt>
							<a name="function:narrative_event:set_event_on_mission_completed"><h3 class="function_name"><strong><code>narrative_event:set_event_on_mission_completed(<code><a href="string.html#">string</a></code> </strong></code><i class="parameter">event</i><code><strong>)</code></strong></h3></a>
						</dt>
						<dd>
							Sets a script event that fires when the mission associated with this event is completed, either successfully or unsuccessfully. Other scripts can listen for this event and respond accordingly.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="string.html#">string</a></code></code></p>
									</td>
									<td>
										<p>event</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../working_data/script/_lib/lib_campaign_narrative_events.lua, line 461</p>
						</dd>
					</dl>
					<dl class="function">
						<dt>
							<a name="function:narrative_event:set_trigger_callback"><h3 class="function_name"><strong><code>narrative_event:set_trigger_callback(<code><a href="function.html#">function</a></code> </strong></code><i class="parameter">callback</i><code><strong>)</code></strong></h3></a>
						</dt>
						<dd>
							Sets a callback to be called when this narrative event is triggered.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="function.html#">function</a></code></code></p>
									</td>
									<td>
										<p>callback</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../working_data/script/_lib/lib_campaign_narrative_events.lua, line 474</p>
						</dd>
					</dl>
				</div>


				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_event:Narrative Event Categories"><h2 class="section_header">Narrative Event Categories</h2></a>
				</div>
				<p>Narrative events will not show advice, or not scroll the camera despite a scroll target being set with <code><a href="#function:narrative_event:set_camera_scroll_target_callback">narrative_event:set_camera_scroll_target_callback</a></code>, if they reason that the player has seen the content enough times before. They do this to avoid irritating the player with too much advice and too many intrusive camera movements for content that they're familiar with. The category of a scripted event and the advice level (high/low/minimal) set by the player is used to make this judgement and determine whether:</p>
				<p><ol><li>Advice should be played and the camera scrolled.</li></p>
				<p><li>Advice should be played with no camera movement.</li></p>
				<p><li>No advice or camera movement should be played.</li></ol></p>
				<p>In all cases the mission associated with the narrative event is triggered, if one was set up.</p>
				<p><table class="simple"><tr><th>Value</th><th>Description</th></tr></p>
				<p><tr><td><code>NARRATIVE_EVENT_CATEGORY_ADVICE_MANDATORY</code></td><td>Sets that the advice associated with this narrative event is mandatory and will always be played, including camera movements, even if the advice level is set to minimal. Only in multiplayer mode or if an advice precondition fails will the advice not be shown in this case. Use this setting sparingly.</td></tr></p>
				<p><tr><td><code>NARRATIVE_EVENT_CATEGORY_ADVICE_HIGH_PRIORITY</code></td><td>Sets that the advice associated with this narrative event is high-priority. The only circumstance in which a narrative event of this category would not show its advice would be if the advice level was set to minimal.</td></tr></p>
				<p><tr><td><code>NARRATIVE_EVENT_CATEGORY_ADVICE_SPECIFIC_TO_FACTION</code></td><td>Sets that the advice is normal priority, but that the advice shown is specific to the faction currently being played and not associated with the same narrative event but for different factions.</td></tr></p>
				<p><tr><td><code>NARRATIVE_EVENT_CATEGORY_ADVICE_SHARED</code></td><td>Sets that the advice is normal priority and is shared amongst many different factions for which this narrative event triggers (e.g. a particular early game mission shared between many different playable factions).</td></tr></table></p>
				<p>The values listed in the table above are defined in script as constants. The default narrative event category is <code>NARRATIVE_EVENT_CATEGORY_ADVICE_SHARED</code>.</p>
				<div class="section_body">
					<dl class="function">
						<dt>
							<a name="function:narrative_event:set_category"><h3 class="function_name"><strong><code>narrative_event:set_category(<code><a href="number.html#">number</a></code> </strong></code><i class="parameter">category enum</i><code><strong>)</code></strong></h3></a>
						</dt>
						<dd>
							Sets the category of the narrative event. Supply a constant value from the table above.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="number.html#">number</a></code></code></p>
									</td>
									<td>
										<p>category enum</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>

							<h4>Example:</h4>
							<div id="example_code"><code>
								 ne_example:set_category(NARRATIVE_EVENT_CATEGORY_ADVICE_SPECIFIC_TO_FACTION)<br />
							</code></div>
							<p class="file_comment">defined in ../working_data/script/_lib/lib_campaign_narrative_events.lua, line 508</p>
						</dd>
					</dl>
				</div>


				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_event:Camera Scrolling"><h2 class="section_header">Camera Scrolling</h2></a>
				</div>
				<p>A scroll-camera target may be set with <code><a href="#function:narrative_event:set_camera_scroll_target_callback">narrative_event:set_camera_scroll_target_callback</a></code>. This specifies a target region, character or position to which the camera is scrolled when the mission and advice are shown.</p>
				<p>If the narrative event has been seen before in the advice history, it may decide not to scroll the camera even when a scroll-camera target has been set. See the <code><a href="#section:narrative_event:Narrative Event Categories">Narrative Event Categories</a></code> section for more information.</p>
				<div class="section_body">
					<dl class="function">
						<dt>
							<a name="function:narrative_event:set_camera_scroll_target_callback"><h3 class="function_name"><strong><code>narrative_event:set_camera_scroll_target_callback(<code><a href="function.html#">function</a></code> </strong></code><i class="parameter">callback</i><code><strong>)</code></strong></h3></a>
						</dt>
						<dd>
							Sets a camera scroll target callback. This function will be stored and then later called when the narrative event is triggered. It should return a <code><a href="string.html#">string</a></code> specifying a region key (the camera will scroll to the settlement in the region), a <code><a href="number.html#">number</a></code> that specifies a character by command-queue index, or a <code><a href="table.html#">table</a></code> containing two numbers specifying a display position.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="function.html#">function</a></code></code></p>
									</td>
									<td>
										<p>callback</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../working_data/script/_lib/lib_campaign_narrative_events.lua, line 545</p>
						</dd>
					</dl>
				</div>


				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_event:Preconditions"><h2 class="section_header">Preconditions</h2></a>
				</div>
				<p>Precondition checks may be added to a narrative event that it has to pass in order to trigger successfully. Once added, each precondition is checked when the narrative event is started and also when the narrative event attempts to trigger.</p>
				<p>Preconditions can be added with a name, which allows them to removed again if configuration is handled by multiple separate scripts that set a default behaviour for a particular narrative event and then customise that default.</p>
				<div class="section_body">
					<dl class="function">
						<dt>
							<a name="function:narrative_event:add_precondition"><h3 class="function_name"><strong><code>narrative_event:add_precondition(<code><a href="function.html#">function</a></code> </strong></code><i class="parameter">precondition</i><code><strong>, [<code><a href="string.html#">string</a></code> </strong></code><i class="parameter">name</i><code><strong>])</code></strong></h3></a>
						</dt>
						<dd>
							Adds a precondition function.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="function.html#">function</a></code></code></p>
									</td>
									<td>
										<p>Precondition function. This should be a function that returns a <code><a href="boolean.html#">boolean</a></code> value. Should the value evaluate to <code>false</code> when the precondition is called, the precondition is failed.</p>
									</td>
								</tr>
								<tr>
									<td>
										<p><strong>2</strong></p>
									</td>
									<td>
										<p><code><code><a href="string.html#">string</a></code></code></p>
									</td>
									<td>
										<p><i>optional, default value=nil</i></p>
										<p>Name by which this precondition function may later be removed with <code><a href="#function:narrative_event:remove_precondition">narrative_event:remove_precondition</a></code>.</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../working_data/script/_lib/lib_campaign_narrative_events.lua, line 571</p>
						</dd>
					</dl>
					<dl class="function">
						<dt>
							<a name="function:narrative_event:remove_precondition"><h3 class="function_name"><strong><code>narrative_event:remove_precondition(<code><a href="string.html#">string</a></code> </strong></code><i class="parameter">name</i><code><strong>)</code></strong></h3></a>
						</dt>
						<dd>
							Removes a previously-added precondition by name.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="string.html#">string</a></code></code></p>
									</td>
									<td>
										<p>Name of precondition to remove.</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../working_data/script/_lib/lib_campaign_narrative_events.lua, line 612</p>
						</dd>
					</dl>
				</div>


				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_event:Advice Preconditions"><h2 class="section_header">Advice Preconditions</h2></a>
				</div>
				<p>Advice precondition checks may be added to suppress the advice registered to the narrative event under certain conditions. Should an advice precondition fail when the narrative event is triggered, the advice will not be shown. The narrative event and its associated mission will still trigger, however.</p>
				<div class="section_body">
					<dl class="function">
						<dt>
							<a name="function:narrative_event:add_advice_precondition"><h3 class="function_name"><strong><code>narrative_event:add_advice_precondition(<code><a href="function.html#">function</a></code> </strong></code><i class="parameter">precondition</i><code><strong>, [<code><a href="string.html#">string</a></code> </strong></code><i class="parameter">name</i><code><strong>])</code></strong></h3></a>
						</dt>
						<dd>
							Adds an advice precondition function.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="function.html#">function</a></code></code></p>
									</td>
									<td>
										<p>Advice precondition function. This should be a function that returns a <code><a href="boolean.html#">boolean</a></code> value. Should the value evaluate to <code>false</code> when the precondition is called, the precondition is failed.</p>
									</td>
								</tr>
								<tr>
									<td>
										<p><strong>2</strong></p>
									</td>
									<td>
										<p><code><code><a href="string.html#">string</a></code></code></p>
									</td>
									<td>
										<p><i>optional, default value=nil</i></p>
										<p>Name for this advice precondition, by which it may be later removed with <code><a href="#function:narrative_event:remove_advice_precondition">narrative_event:remove_advice_precondition</a></code>.</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../working_data/script/_lib/lib_campaign_narrative_events.lua, line 651</p>
						</dd>
					</dl>
					<dl class="function">
						<dt>
							<a name="function:narrative_event:remove_advice_precondition"><h3 class="function_name"><strong><code>narrative_event:remove_advice_precondition(<code><a href="string.html#">string</a></code> </strong></code><i class="parameter">name</i><code><strong>)</code></strong></h3></a>
						</dt>
						<dd>
							Removes a previously-added advice precondition by name.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="string.html#">string</a></code></code></p>
									</td>
									<td>
										<p>name</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../working_data/script/_lib/lib_campaign_narrative_events.lua, line 692</p>
						</dd>
					</dl>
				</div>


				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_event:Trigger Conditions"><h2 class="section_header">Trigger Conditions</h2></a>
				</div>
				<p>Trigger conditions must be added to a narrative event to allow it to trigger. One or more trigger conditions may be added with <code><a href="#function:narrative_event:add_trigger_condition">narrative_event:add_trigger_condition</a></code>.</p>
				<p>If no trigger conditions are added to a narrative event the only way it can trigger is by specifying it must trigger immediately when calling <code><a href="#function:narrative_event:start">narrative_event:start</a></code>.</p>
				<div class="section_body">
					<dl class="function">
						<dt>
							<a name="function:narrative_event:add_trigger_condition"><h3 class="function_name"><strong><code>narrative_event:add_trigger_condition(<code><a href="string.html#">string</a></code> </strong></code><i class="parameter">event</i><code><strong>, [<code><a href="function.html#">function</a></code> </strong></code><i class="parameter">condition</i><code><strong>], [<code><a href="string.html#">string</a></code> </strong></code><i class="parameter">name</i><code><strong>])</code></strong></h3></a>
						</dt>
						<dd>
							Adds a trigger event and condition. If the narrative event has been started and the supplied script event is received and the optional condition passes, and no preconditions fail, then the narrative event will attempt to trigger.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="string.html#">string</a></code></code></p>
									</td>
									<td>
										<p>Event name.</p>
									</td>
								</tr>
								<tr>
									<td>
										<p><strong>2</strong></p>
									</td>
									<td>
										<p><code><code><a href="function.html#">function</a></code></code></p>
									</td>
									<td>
										<p><i>optional, default value=true</i></p>
										<p>Conditional check to perform when the supplied event is received. If this returns true then the check passes. Alternatively, <code>true</code> (the default value) may be specified to always pass when the event is received.</p>
									</td>
								</tr>
								<tr>
									<td>
										<p><strong>3</strong></p>
									</td>
									<td>
										<p><code><code><a href="string.html#">string</a></code></code></p>
									</td>
									<td>
										<p><i>optional, default value=nil</i></p>
										<p>Name for this trigger listener. If specified, the trigger listener may be later removed during configuration by <code><a href="#function:narrative_event:remove_trigger_condition">narrative_event:remove_trigger_condition</a></code>.</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../working_data/script/_lib/lib_campaign_narrative_events.lua, line 731</p>
						</dd>
					</dl>
					<dl class="function">
						<dt>
							<a name="function:narrative_event:remove_trigger_condition"><h3 class="function_name"><strong><code>narrative_event:remove_trigger_condition()</code></strong></h3></a>
						</dt>
						<dd>
							Removes a previously-added trigger condition by name.


							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../working_data/script/_lib/lib_campaign_narrative_events.lua, line 787</p>
						</dd>
					</dl>
				</div>


				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_event:Starting"><h2 class="section_header">Starting</h2></a>
				</div>
				<div class="section_body">
					<dl class="function">
						<dt>
							<a name="function:narrative_event:start"><h3 class="function_name"><strong><code>narrative_event:start([<code><a href="boolean.html#">boolean</a></code> </strong></code><i class="parameter">trigger immediately</i><code><strong>])</code></strong></h3></a>
						</dt>
						<dd>
							Starts the narrative event listeners. If the narrative event has already triggered this campaign, or if its payload has already been inherited, then the listeners will not be started.<br />
							If the optional flag is set, the narrative event will attempt to trigger immediately on startup.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="boolean.html#">boolean</a></code></code></p>
									</td>
									<td>
										<p><i>optional, default value=false</i></p>
										<p>trigger immediately</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../working_data/script/_lib/lib_campaign_narrative_events.lua, line 812</p>
						</dd>
					</dl>
				</div>


			</div>

		</div>

		<div id="about">Last updated 25/08/2021 12:07:49</div>

	</div>

	<script src="../searchdata.js"></script>
	<script src="../search.js"></script>
	<script>const page_env = "Campaign"; const path_to_document_root = "../";</script>

</body>
</html>